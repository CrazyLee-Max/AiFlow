{
    "kind": "coffeeMachine",
    "name": "咖啡机节点",
    "description": "智能咖啡机设备节点,通过API调用真实咖啡机制作咖啡,支持设备互斥访问",
    "template": {
        "id": "咖啡机节点ID",
        "name": "咖啡机",
        "kind": "coffeeMachine",
        "inputPorts": ["input"],
        "outputPorts": ["success", "busy", "error"],
        "inputParams": [
            {
                "code": "coffeeType",
                "id": "节点ID_coffeeType",
                "type": {
                    "source": "default",
                    "typeId": "enum",
                    "typeName": "Enum",
                    "enumValues": ["美式", "拿铁", "加浓", "卡布奇诺", "摩卡"]
                },
                "required": true,
                "description": "要制作的咖啡类型",
                "valueExpr": {
                    "kind": "stringConst",
                    "value": "美式"
                }
            }
        ],
        "outputParams": [
            {
                "code": "result",
                "id": "节点ID_result",
                "type": {
                    "source": "default",
                    "typeId": "boolean",
                    "typeName": "Boolean"
                },
                "description": "操作结果,true表示成功,false表示设备忙碌",
                "binding": {
                    "source": "apiResponse",
                    "path": "$.success"
                }
            },
            {
                "code": "errorMessage",
                "id": "节点ID_errorMessage",
                "type": {
                    "source": "default",
                    "typeId": "string",
                    "typeName": "String"
                },
                "description": "错误信息(仅在error端口时有值)",
                "binding": {
                    "source": "apiResponse",
                    "path": "$.error"
                }
            }
        ],
        "deviceConfig": {
            "deviceId": {
                "type": "string",
                "description": "咖啡机设备ID,用于标识具体的咖啡机实例",
                "required": false,
                "defaultValue": "auto",
                "options": ["auto", "coffee_machine_001", "coffee_machine_002", "coffee_machine_003"],
                "note": "auto表示自动选择空闲设备,也可指定具体设备ID"
            },
            "apiEndpoint": {
                "type": "string",
                "description": "咖啡机API端点地址",
                "required": false,
                "defaultValue": "http://localhost:8080/api/coffee-machine",
                "note": "智能咖啡机的HTTP API地址"
            },
            "timeout": {
                "type": "number",
                "description": "API调用超时时间(毫秒)",
                "required": false,
                "defaultValue": 30000,
                "min": 1000,
                "max": 300000
            }
        },
        "action": {
            "method": "makeCoffee",
            "description": "调用咖啡机API制作咖啡",
            "apiCall": {
                "method": "POST",
                "path": "/make",
                "requestBody": {
                    "deviceId": "${deviceConfig.deviceId}",
                    "action": "makeCoffee",
                    "coffeeType": "${inputParams.coffeeType}"
                },
                "expectedResponse": {
                    "format": "json",
                    "example": {
                        "success": true,
                        "error": null,
                        "data": {
                            "coffeeType": "美式",
                            "estimatedTime": 30
                        }
                    }
                }
            }
        },
        "portRouting": {
            "description": "根据API返回值自动路由到不同端口",
            "rules": [
                {
                    "port": "success",
                    "condition": "result == true",
                    "description": "咖啡制作成功,设备空闲可用"
                },
                {
                    "port": "busy",
                    "condition": "result == false && errorMessage contains '设备忙碌'",
                    "description": "设备正在被其他流程使用,当前流程需等待或重试"
                },
                {
                    "port": "error",
                    "condition": "result == false && errorMessage not contains '设备忙碌'",
                    "description": "设备故障或操作异常"
                }
            ]
        },
        "executionBehavior": {
            "type": "async",
            "description": "异步执行,等待设备返回结果后再继续",
            "lockStrategy": "device-level",
            "lockKey": "${deviceConfig.deviceId}",
            "retryOnBusy": {
                "enabled": false,
                "maxRetries": 0,
                "retryInterval": 0,
                "note": "不自动重试,由流程设计者通过busy端口控制重试逻辑"
            }
        }
    }
}